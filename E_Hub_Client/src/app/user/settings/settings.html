<!-- User Settings Template -->
<div class="settings-container">
  <!-- Decorative Elements -->
  <div class="geometric-decoration decoration-1"></div>
  <div class="geometric-decoration decoration-2"></div>
  <div class="geometric-decoration decoration-3"></div>

  <!-- Settings Header -->
  <div class="settings-header">
    <button type="button" class="back-button" routerLink="/user/profile">
      <span class="back-icon">‚Üê</span>
      <span class="back-text">Quay l·∫°i h·ªì s∆°</span>
    </button>
    <h1 class="page-title">C√†i ƒë·∫∑t t√†i kho·∫£n</h1>
    <p class="page-subtitle">Qu·∫£n l√Ω b·∫£o m·∫≠t v√† t√πy ch·ªçn t√†i kho·∫£n c·ªßa b·∫°n</p>
  </div>

  <!-- Settings Content -->
  <div class="settings-content">
    
    <!-- Password Change Section -->
    <div class="settings-section">
      <div class="section-header">
        <h2 class="section-title">üîí ƒê·ªïi m·∫≠t kh·∫©u</h2>
        <p class="section-description">C·∫≠p nh·∫≠t m·∫≠t kh·∫©u ƒë·ªÉ b·∫£o m·∫≠t t√†i kho·∫£n</p>
      </div>

      <form [formGroup]="passwordForm" (ngSubmit)="onChangePassword()" class="password-form">
        
        <!-- Current Password -->
        <div class="form-group">
          <label class="form-label">M·∫≠t kh·∫©u hi·ªán t·∫°i</label>
          <div class="password-input-wrapper">
            <input [type]="showCurrentPassword ? 'text' : 'password'"
                   formControlName="currentPassword"
                   class="form-input"
                   placeholder="Nh·∫≠p m·∫≠t kh·∫©u hi·ªán t·∫°i"
                   [class.error]="isPasswordFieldInvalid('currentPassword')">
            <button type="button" 
                    class="password-toggle"
                    (click)="showCurrentPassword = !showCurrentPassword">
              {{ showCurrentPassword ? 'üôà' : 'üëÅÔ∏è' }}
            </button>
          </div>
          <div *ngIf="isPasswordFieldInvalid('currentPassword')" class="error-message">
            <span *ngIf="passwordForm.get('currentPassword')?.errors?.['required']">Vui l√≤ng nh·∫≠p m·∫≠t kh·∫©u hi·ªán t·∫°i</span>
          </div>
        </div>

        <!-- New Password -->
        <div class="form-group">
          <label class="form-label">M·∫≠t kh·∫©u m·ªõi</label>
          <div class="password-input-wrapper">
            <input [type]="showNewPassword ? 'text' : 'password'"
                   formControlName="newPassword"
                   class="form-input"
                   placeholder="Nh·∫≠p m·∫≠t kh·∫©u m·ªõi"
                   [class.error]="isPasswordFieldInvalid('newPassword')">
            <button type="button" 
                    class="password-toggle"
                    (click)="showNewPassword = !showNewPassword">
              {{ showNewPassword ? 'üôà' : 'üëÅÔ∏è' }}
            </button>
          </div>
          
          <!-- Password Strength Indicator -->
          <div class="password-strength">
            <div class="strength-bar">
              <div class="strength-fill" [style.width.%]="passwordStrength" [class]="passwordStrengthClass"></div>
            </div>
            <span class="strength-text">{{ passwordStrengthText }}</span>
          </div>

          <div *ngIf="isPasswordFieldInvalid('newPassword')" class="error-message">
            <span *ngIf="passwordForm.get('newPassword')?.errors?.['required']">Vui l√≤ng nh·∫≠p m·∫≠t kh·∫©u m·ªõi</span>
            <span *ngIf="passwordForm.get('newPassword')?.errors?.['minlength']">M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 8 k√Ω t·ª±</span>
            <span *ngIf="passwordForm.get('newPassword')?.errors?.['pattern']">M·∫≠t kh·∫©u ph·∫£i ch·ª©a ch·ªØ hoa, ch·ªØ th∆∞·ªùng, s·ªë v√† k√Ω t·ª± ƒë·∫∑c bi·ªát</span>
          </div>
        </div>

        <!-- Confirm Password -->
        <div class="form-group">
          <label class="form-label">X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi</label>
          <div class="password-input-wrapper">
            <input [type]="showConfirmPassword ? 'text' : 'password'"
                   formControlName="confirmPassword"
                   class="form-input"
                   placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u m·ªõi"
                   [class.error]="isPasswordFieldInvalid('confirmPassword')">
            <button type="button" 
                    class="password-toggle"
                    (click)="showConfirmPassword = !showConfirmPassword">
              {{ showConfirmPassword ? 'üôà' : 'üëÅÔ∏è' }}
            </button>
          </div>
          <div *ngIf="isPasswordFieldInvalid('confirmPassword')" class="error-message">
            <span *ngIf="passwordForm.get('confirmPassword')?.errors?.['required']">Vui l√≤ng x√°c nh·∫≠n m·∫≠t kh·∫©u</span>
            <span *ngIf="passwordForm.hasError('mismatch')">M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp</span>
          </div>
        </div>

        <!-- Submit Button -->
        <button type="submit" 
                class="btn btn-primary"
                [disabled]="passwordForm.invalid || isChangingPassword">
          <span *ngIf="isChangingPassword" class="loading-spinner"></span>
          {{ isChangingPassword ? 'ƒêang thay ƒë·ªïi...' : 'ƒê·ªïi m·∫≠t kh·∫©u' }}
        </button>
      </form>
    </div>

    <!-- Security Settings -->
    <div class="settings-section">
      <div class="section-header">
        <h2 class="section-title">üõ°Ô∏è B·∫£o m·∫≠t t√†i kho·∫£n</h2>
        <p class="section-description">C√°c t√πy ch·ªçn b·∫£o m·∫≠t n√¢ng cao</p>
      </div>

      <div class="security-options">
        
        <!-- Two-Factor Authentication -->
        <div class="security-option">
          <div class="option-info">
            <h3 class="option-title">X√°c th·ª±c hai y·∫øu t·ªë (2FA)</h3>
            <p class="option-description">TƒÉng c∆∞·ªùng b·∫£o m·∫≠t v·ªõi m√£ x√°c th·ª±c t·ª´ ƒëi·ªán tho·∫°i</p>
          </div>
          <div class="option-control">
            <label class="toggle-switch">
              <input type="checkbox" [(ngModel)]="securitySettings.twoFactorEnabled" (change)="onToggle2FA()">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

        <!-- Email Notifications -->
        <div class="security-option">
          <div class="option-info">
            <h3 class="option-title">Th√¥ng b√°o ƒëƒÉng nh·∫≠p</h3>
            <p class="option-description">Nh·∫≠n email khi c√≥ ƒëƒÉng nh·∫≠p t·ª´ thi·∫øt b·ªã m·ªõi</p>
          </div>
          <div class="option-control">
            <label class="toggle-switch">
              <input type="checkbox" [(ngModel)]="securitySettings.loginNotifications">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

        <!-- Session Management -->
        <div class="security-option">
          <div class="option-info">
            <h3 class="option-title">T·ª± ƒë·ªông ƒëƒÉng xu·∫•t</h3>
            <p class="option-description">ƒêƒÉng xu·∫•t t·ª± ƒë·ªông khi kh√¥ng ho·∫°t ƒë·ªông</p>
          </div>
          <div class="option-control">
            <select [(ngModel)]="securitySettings.autoLogoutMinutes" class="select-input">
              <option value="30">30 ph√∫t</option>
              <option value="60">1 gi·ªù</option>
              <option value="120">2 gi·ªù</option>
              <option value="0">Kh√¥ng bao gi·ªù</option>
            </select>
          </div>
        </div>

      </div>

      <!-- Active Sessions -->
      <div class="active-sessions">
        <h3 class="subsection-title">Phi√™n ƒëƒÉng nh·∫≠p hi·ªán t·∫°i</h3>
        <div class="session-list">
          <div *ngFor="let session of activeSessions" class="session-item">
            <div class="session-info">
              <div class="session-device">{{ session.device }}</div>
              <div class="session-details">
                <span class="session-location">{{ session.location }}</span>
                <span class="session-time">{{ formatDate(session.lastActive) }}</span>
              </div>
            </div>
            <div class="session-actions">
              <span *ngIf="session.isCurrent" class="current-badge">Hi·ªán t·∫°i</span>
              <button *ngIf="!session.isCurrent" 
                      type="button" 
                      class="btn btn-small btn-danger"
                      (click)="terminateSession(session.id)">
                ƒêƒÉng xu·∫•t
              </button>
            </div>
          </div>
        </div>
        <button type="button" 
                class="btn btn-secondary btn-block"
                (click)="terminateAllSessions()">
          ƒêƒÉng xu·∫•t t·∫•t c·∫£ thi·∫øt b·ªã kh√°c
        </button>
      </div>
    </div>

    <!-- Privacy Settings -->
    <div class="settings-section">
      <div class="section-header">
        <h2 class="section-title">üîê Quy·ªÅn ri√™ng t∆∞</h2>
        <p class="section-description">Ki·ªÉm so√°t th√¥ng tin c√° nh√¢n c·ªßa b·∫°n</p>
      </div>

      <div class="privacy-options">
        
        <!-- Profile Visibility -->
        <div class="privacy-option">
          <div class="option-info">
            <h3 class="option-title">Hi·ªÉn th·ªã h·ªì s∆° c√¥ng khai</h3>
            <p class="option-description">Cho ph√©p ng∆∞·ªùi kh√°c xem th√¥ng tin c∆° b·∫£n c·ªßa b·∫°n</p>
          </div>
          <div class="option-control">
            <label class="toggle-switch">
              <input type="checkbox" [(ngModel)]="privacySettings.publicProfile">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

        <!-- Learning Progress -->
        <div class="privacy-option">
          <div class="option-info">
            <h3 class="option-title">Hi·ªÉn th·ªã ti·∫øn ƒë·ªô h·ªçc t·∫≠p</h3>
            <p class="option-description">Chia s·∫ª ti·∫øn ƒë·ªô h·ªçc t·∫≠p v·ªõi b·∫°n b√®</p>
          </div>
          <div class="option-control">
            <label class="toggle-switch">
              <input type="checkbox" [(ngModel)]="privacySettings.showProgress">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

      </div>
    </div>

    <!-- Danger Zone -->
    <div class="settings-section danger-zone">
      <div class="section-header">
        <h2 class="section-title">‚ö†Ô∏è V√πng nguy hi·ªÉm</h2>
        <p class="section-description">C√°c h√†nh ƒë·ªông kh√¥ng th·ªÉ ho√†n t√°c</p>
      </div>

      <div class="danger-actions">
        <button type="button" 
                class="btn btn-danger btn-block"
                (click)="showDeleteConfirm = true">
          üóëÔ∏è X√≥a t√†i kho·∫£n vƒ©nh vi·ªÖn
        </button>
      </div>
    </div>

  </div>
</div>

<!-- Delete Account Confirmation Modal -->
<div *ngIf="showDeleteConfirm" class="modal-overlay" (click)="showDeleteConfirm = false">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <h2 class="modal-title">‚ö†Ô∏è X√°c nh·∫≠n x√≥a t√†i kho·∫£n</h2>
    <p class="modal-text">
      B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a t√†i kho·∫£n vƒ©nh vi·ªÖn? T·∫•t c·∫£ d·ªØ li·ªáu c·ªßa b·∫°n s·∫Ω b·ªã m·∫•t v√† kh√¥ng th·ªÉ kh√¥i ph·ª•c.
    </p>
    <div class="confirm-input">
      <label>Nh·∫≠p "X√ìA T√ÄI KHO·∫¢N" ƒë·ªÉ x√°c nh·∫≠n:</label>
      <input type="text" 
             [(ngModel)]="deleteConfirmText" 
             class="form-input"
             placeholder="X√ìA T√ÄI KHO·∫¢N">
    </div>
    <div class="modal-actions">
      <button type="button" class="btn btn-secondary" (click)="showDeleteConfirm = false">
        H·ªßy b·ªè
      </button>
      <button type="button" 
              class="btn btn-danger" 
              [disabled]="deleteConfirmText !== 'X√ìA T√ÄI KHO·∫¢N'"
              (click)="deleteAccount()">
        X√≥a t√†i kho·∫£n
      </button>
    </div>
  </div>
</div>

<!-- 2FA Setup Modal -->
<div *ngIf="show2FAModal" class="modal-overlay" (click)="show2FAModal = false">
  <div class="modal-content large" (click)="$event.stopPropagation()">
    <h2 class="modal-title">üõ°Ô∏è Thi·∫øt l·∫≠p x√°c th·ª±c hai y·∫øu t·ªë</h2>
    
    <div class="twofa-setup">
      <div class="setup-step">
        <h3>B∆∞·ªõc 1: T·∫£i ·ª©ng d·ª•ng x√°c th·ª±c</h3>
        <p>T·∫£i Google Authenticator ho·∫∑c Authy tr√™n ƒëi·ªán tho·∫°i c·ªßa b·∫°n.</p>
      </div>

      <div class="setup-step">
        <h3>B∆∞·ªõc 2: Qu√©t m√£ QR</h3>
        <div class="qr-code">
          <div class="qr-placeholder">
            üì± QR Code s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y
          </div>
        </div>
        <p class="backup-code">M√£ d·ª± ph√≤ng: {{ backupCode }}</p>
      </div>

      <div class="setup-step">
        <h3>B∆∞·ªõc 3: Nh·∫≠p m√£ x√°c th·ª±c</h3>
        <input type="text" 
               [(ngModel)]="twoFACode" 
               class="form-input"
               placeholder="Nh·∫≠p 6 ch·ªØ s·ªë"
               maxlength="6">
      </div>
    </div>

    <div class="modal-actions">
      <button type="button" class="btn btn-secondary" (click)="show2FAModal = false">
        H·ªßy b·ªè
      </button>
      <button type="button" 
              class="btn btn-primary" 
              [disabled]="twoFACode.length !== 6"
              (click)="confirm2FA()">
        K√≠ch ho·∫°t 2FA
      </button>
    </div>
  </div>
</div>