<!-- Course Form Template -->
<div class="course-form-container">
  <!-- Decorative Elements -->
  <div class="geometric-decoration decoration-1"></div>
  <div class="geometric-decoration decoration-2"></div>
  <div class="geometric-decoration decoration-3"></div>

  <!-- Header -->
  <div class="form-header">
    <button type="button" class="back-button" routerLink="/courses">
      <span class="back-icon">‚Üê</span>
      <span class="back-text">Quay l·∫°i danh s√°ch</span>
    </button>
    
    <h1 class="form-title">
      {{ isEditMode ? '‚úèÔ∏è Ch·ªânh s·ª≠a kh√≥a h·ªçc' : '‚ûï T·∫°o kh√≥a h·ªçc m·ªõi' }}
    </h1>
  </div>

  <!-- Course Form -->
  <form class="course-form" (ngSubmit)="onSubmit()" #courseForm="ngForm" *ngIf="!isLoading">
    
    <!-- Basic Information Section -->
    <div class="form-section">
      <h2 class="section-title">üìö Th√¥ng tin c∆° b·∫£n</h2>
      
      <div class="form-grid">
        <!-- Course Title -->
        <div class="form-group full-width">
          <label for="title" class="form-label">Ti√™u ƒë·ªÅ kh√≥a h·ªçc *</label>
          <input 
            type="text" 
            id="title" 
            name="title"
            class="form-input"
            [(ngModel)]="courseData.title"
            #titleInput="ngModel"
            required
            maxlength="200"
            placeholder="Nh·∫≠p ti√™u ƒë·ªÅ kh√≥a h·ªçc">
          <div class="form-error" *ngIf="titleInput.invalid && titleInput.touched">
            <span *ngIf="titleInput.errors?.['required']">Ti√™u ƒë·ªÅ kh√≥a h·ªçc l√† b·∫Øt bu·ªôc</span>
            <span *ngIf="titleInput.errors?.['maxlength']">Ti√™u ƒë·ªÅ kh√¥ng ƒë∆∞·ª£c v∆∞·ª£t qu√° 200 k√Ω t·ª±</span>
          </div>
          <div class="char-count">{{ courseData.title.length }}/200</div>
        </div>

        <!-- Course Description -->
        <div class="form-group full-width">
          <label for="description" class="form-label">M√¥ t·∫£ kh√≥a h·ªçc *</label>
          <textarea 
            id="description" 
            name="description"
            class="form-textarea"
            [(ngModel)]="courseData.description"
            #descriptionInput="ngModel"
            required
            maxlength="1000"
            rows="4"
            placeholder="M√¥ t·∫£ chi ti·∫øt v·ªÅ n·ªôi dung v√† m·ª•c ti√™u c·ªßa kh√≥a h·ªçc"></textarea>
          <div class="form-error" *ngIf="descriptionInput.invalid && descriptionInput.touched">
            <span *ngIf="descriptionInput.errors?.['required']">M√¥ t·∫£ kh√≥a h·ªçc l√† b·∫Øt bu·ªôc</span>
            <span *ngIf="descriptionInput.errors?.['maxlength']">M√¥ t·∫£ kh√¥ng ƒë∆∞·ª£c v∆∞·ª£t qu√° 1000 k√Ω t·ª±</span>
          </div>
          <div class="char-count">{{ courseData.description.length }}/1000</div>
        </div>

        <!-- Course Level -->
        <div class="form-group">
          <label for="level" class="form-label">C·∫•p ƒë·ªô *</label>
          <select 
            id="level" 
            name="level"
            class="form-select"
            [(ngModel)]="courseData.level"
            #levelInput="ngModel"
            required>
            <option value="">Ch·ªçn c·∫•p ƒë·ªô</option>
            <option value="BEGINNER">C∆° b·∫£n</option>
            <option value="INTERMEDIATE">Trung b√¨nh</option>
            <option value="ADVANCED">N√¢ng cao</option>
          </select>
          <div class="form-error" *ngIf="levelInput.invalid && levelInput.touched">
            <span *ngIf="levelInput.errors?.['required']">Vui l√≤ng ch·ªçn c·∫•p ƒë·ªô</span>
          </div>
        </div>

        <!-- Course Price -->
        <div class="form-group">
          <label for="price" class="form-label">Gi√° kh√≥a h·ªçc (VNƒê)</label>
          <input 
            type="number" 
            id="price" 
            name="price"
            class="form-input"
            [(ngModel)]="courseData.price"
            #priceInput="ngModel"
            min="0"
            max="10000000"
            placeholder="0 = Mi·ªÖn ph√≠">
          <div class="form-error" *ngIf="priceInput.invalid && priceInput.touched">
            <span *ngIf="priceInput.errors?.['min']">Gi√° kh√¥ng ƒë∆∞·ª£c √¢m</span>
            <span *ngIf="priceInput.errors?.['max']">Gi√° kh√¥ng ƒë∆∞·ª£c v∆∞·ª£t qu√° 10.000.000 VNƒê</span>
          </div>
          <div class="price-display">{{ formatPrice(courseData.price) }}</div>
        </div>

        <!-- Course Status -->
        <div class="form-group">
          <label for="status" class="form-label">Tr·∫°ng th√°i *</label>
          <select 
            id="status" 
            name="status"
            class="form-select"
            [(ngModel)]="courseData.status"
            #statusInput="ngModel"
            required>
            <option value="">Ch·ªçn tr·∫°ng th√°i</option>
            <option value="DRAFT">Nh√°p</option>
            <option value="PUBLISHED">Xu·∫•t b·∫£n</option>
            <option value="ARCHIVED">L∆∞u tr·ªØ</option>
          </select>
          <div class="form-error" *ngIf="statusInput.invalid && statusInput.touched">
            <span *ngIf="statusInput.errors?.['required']">Vui l√≤ng ch·ªçn tr·∫°ng th√°i</span>
          </div>
        </div>

        <!-- Author (readonly in edit mode) -->
        <div class="form-group">
          <label for="author" class="form-label">T√°c gi·∫£ *</label>
          <input 
            type="text" 
            id="author" 
            name="author"
            class="form-input"
            [(ngModel)]="courseData.author"
            #authorInput="ngModel"
            [readonly]="isEditMode"
            required
            placeholder="T√™n t√°c gi·∫£">
          <div class="form-error" *ngIf="authorInput.invalid && authorInput.touched">
            <span *ngIf="authorInput.errors?.['required']">T√™n t√°c gi·∫£ l√† b·∫Øt bu·ªôc</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Media Section -->
    <div class="form-section">
      <h2 class="section-title">üñºÔ∏è H√¨nh ·∫£nh v√† Media</h2>
      
      <!-- Thumbnail Upload -->
      <div class="form-group full-width">
        <label class="form-label">·∫¢nh thumbnail</label>
        
        <div class="thumbnail-upload-area">
          <div class="current-thumbnail" *ngIf="courseData.thumbnailUrl">
            <img [src]="courseData.thumbnailUrl" alt="Current thumbnail" class="thumbnail-preview">
            <button type="button" class="remove-thumbnail" (click)="removeThumbnail()">
              ‚úï X√≥a ·∫£nh
            </button>
          </div>
          
          <div class="upload-zone" 
               [class.drag-over]="isDragOver"
               (dragover)="onDragOver($event)"
               (dragleave)="onDragLeave($event)"
               (drop)="onDrop($event)"
               (click)="fileInput.click()">
            <div class="upload-icon">üìÅ</div>
            <div class="upload-text">
              <strong>K√©o th·∫£ ·∫£nh v√†o ƒë√¢y</strong> ho·∫∑c <strong>nh·∫•n ƒë·ªÉ ch·ªçn</strong>
            </div>
            <div class="upload-hint">
              ƒê·ªãnh d·∫°ng: JPG, PNG, WebP. K√≠ch th∆∞·ªõc t·ªëi ƒëa: 5MB
            </div>
            
            <input 
              #fileInput
              type="file" 
              accept="image/*" 
              (change)="onFileSelect($event)" 
              class="file-input"
              hidden>
          </div>
        </div>
      </div>
    </div>

    <!-- Categories and Tags Section -->
    <div class="form-section">
      <h2 class="section-title">üè∑Ô∏è Ph√¢n lo·∫°i v√† Tags</h2>
      
      <div class="form-grid">
        <!-- Categories -->
        <div class="form-group">
          <label class="form-label">Danh m·ª•c</label>
          <div class="categories-grid">
            <label *ngFor="let category of availableCategories" class="checkbox-label">
              <input 
                type="checkbox" 
                [checked]="courseData.categories.includes(category)"
                (change)="toggleCategory(category)"
                class="checkbox-input">
              <span class="checkbox-custom"></span>
              <span class="checkbox-text">{{ category }}</span>
            </label>
          </div>
        </div>

        <!-- Tags -->
        <div class="form-group">
          <label class="form-label">Tags</label>
          <div class="tags-input-container">
            <div class="tags-list">
              <span *ngFor="let tag of courseData.tags; let i = index" class="tag-item">
                {{ tag }}
                <button type="button" (click)="removeTag(i)" class="tag-remove">‚úï</button>
              </span>
            </div>
            <input 
              type="text" 
              class="tag-input"
              placeholder="Nh·∫≠p tag v√† nh·∫•n Enter"
              (keydown.enter)="addTag($event)"
              #tagInput>
          </div>
        </div>
      </div>
    </div>

    <!-- Requirements Section -->
    <div class="form-section">
      <h2 class="section-title">üìã Y√™u c·∫ßu v√† M·ª•c ti√™u</h2>
      
      <div class="form-grid">
        <!-- Prerequisites -->
        <div class="form-group">
          <label class="form-label">Ki·∫øn th·ª©c c·∫ßn c√≥</label>
          <div class="list-input-container">
            <div class="list-items">
              <div *ngFor="let req of courseData.prerequisites; let i = index" class="list-item">
                <span class="item-text">{{ req }}</span>
                <button type="button" (click)="removePrerequisite(i)" class="item-remove">‚úï</button>
              </div>
            </div>
            <div class="add-item-form">
              <input 
                type="text" 
                class="form-input"
                placeholder="Nh·∫≠p ki·∫øn th·ª©c c·∫ßn c√≥"
                #prereqInput>
              <button 
                type="button" 
                (click)="addPrerequisite(prereqInput)"
                class="btn btn-secondary">
                Th√™m
              </button>
            </div>
          </div>
        </div>

        <!-- Learning Objectives -->
        <div class="form-group">
          <label class="form-label">M·ª•c ti√™u h·ªçc t·∫≠p</label>
          <div class="list-input-container">
            <div class="list-items">
              <div *ngFor="let obj of courseData.learningObjectives; let i = index" class="list-item">
                <span class="item-text">{{ obj }}</span>
                <button type="button" (click)="removeLearningObjective(i)" class="item-remove">‚úï</button>
              </div>
            </div>
            <div class="add-item-form">
              <input 
                type="text" 
                class="form-input"
                placeholder="Nh·∫≠p m·ª•c ti√™u h·ªçc t·∫≠p"
                #objectiveInput>
              <button 
                type="button" 
                (click)="addLearningObjective(objectiveInput)"
                class="btn btn-secondary">
                Th√™m
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Form Actions -->
    <div class="form-actions">
      <button 
        type="button" 
        class="btn btn-outline btn-large"
        routerLink="/courses">
        H·ªßy
      </button>
      
      <button 
        type="button" 
        class="btn btn-secondary btn-large"
        (click)="saveDraft()"
        [disabled]="!courseForm.valid || isSubmitting">
        <span class="btn-icon">üíæ</span>
        L∆∞u nh√°p
      </button>
      
      <button 
        type="submit" 
        class="btn btn-primary btn-large"
        [disabled]="!courseForm.valid || isSubmitting">
        <span class="btn-icon">{{ isEditMode ? 'üíæ' : '‚ûï' }}</span>
        {{ isEditMode ? 'C·∫≠p nh·∫≠t' : 'T·∫°o kh√≥a h·ªçc' }}
      </button>
    </div>
  </form>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="loading-spinner"></div>
    <p class="loading-text">{{ isEditMode ? 'ƒêang t·∫£i th√¥ng tin kh√≥a h·ªçc...' : 'ƒêang kh·ªüi t·∫°o form...' }}</p>
  </div>
</div>

<!-- Success Modal -->
<div *ngIf="showSuccessModal" class="modal-overlay" (click)="showSuccessModal = false">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header success">
      <h2 class="modal-title">‚úÖ Th√†nh c√¥ng!</h2>
      <button type="button" class="close-btn" (click)="showSuccessModal = false">‚úï</button>
    </div>
    
    <div class="modal-body">
      <p class="success-message">
        {{ isEditMode ? 'Kh√≥a h·ªçc ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t th√†nh c√¥ng!' : 'Kh√≥a h·ªçc m·ªõi ƒë√£ ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng!' }}
      </p>
    </div>
    
    <div class="modal-actions">
      <button type="button" class="btn btn-secondary" (click)="showSuccessModal = false">
        ƒê√≥ng
      </button>
      <button type="button" class="btn btn-primary" (click)="navigateToCourse()">
        Xem kh√≥a h·ªçc
      </button>
    </div>
  </div>
</div>