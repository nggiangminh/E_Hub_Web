<!-- Lesson Viewer Template -->
<div class="lesson-viewer-container">
  <!-- Decorative Elements -->
  <div class="geometric-decoration decoration-1"></div>
  <div class="geometric-decoration decoration-2"></div>
  <div class="geometric-decoration decoration-3"></div>

  <!-- Navigation Header -->
  <div class="viewer-header">
    <div class="navigation-controls">
      <button type="button" class="nav-button back-button" (click)="goBackToCourse()">
        <span class="nav-icon">‚Üê</span>
        <span class="nav-text">Quay l·∫°i kh√≥a h·ªçc</span>
      </button>
      
      <div class="lesson-navigation" *ngIf="!isLoading">
        <button type="button" 
                class="nav-button prev-button"
                (click)="goToPreviousLesson()"
                [disabled]="!hasPreviousLesson">
          <span class="nav-icon">‚¨ÖÔ∏è</span>
          <span class="nav-text">B√†i tr∆∞·ªõc</span>
        </button>
        
        <button type="button" 
                class="nav-button next-button"
                (click)="goToNextLesson()"
                [disabled]="!hasNextLesson">
          <span class="nav-text">B√†i ti·∫øp theo</span>
          <span class="nav-icon">‚û°Ô∏è</span>
        </button>
      </div>
    </div>

    <!-- Progress Bar -->
    <div class="progress-section" *ngIf="!isLoading">
      <div class="progress-info">
        <span class="progress-text">
          B√†i {{ currentLessonIndex + 1 }} / {{ totalLessons }}
        </span>
        <span class="progress-percentage">
          {{ progressPercentage }}% ho√†n th√†nh
        </span>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="progressPercentage"></div>
      </div>
    </div>
  </div>

  <!-- Lesson Content -->
  <div class="lesson-content" *ngIf="currentLesson && !isLoading">
    
    <!-- Lesson Info -->
    <div class="lesson-info-section">
      <div class="lesson-header">
        <div class="lesson-type-badge" [class]="'type-' + currentLesson.lessonType.toLowerCase()">
          <span class="type-icon">{{ getLessonTypeIcon(currentLesson.lessonType) }}</span>
          <span class="type-text">{{ getLessonTypeDisplay(currentLesson.lessonType) }}</span>
        </div>
        
        <div class="lesson-duration" *ngIf="currentLesson.durationSeconds">
          <span class="duration-icon">‚è±Ô∏è</span>
          <span class="duration-text">{{ formatDuration(currentLesson.durationSeconds) }}</span>
        </div>
      </div>

      <h1 class="lesson-title">{{ currentLesson.title }}</h1>
      
      <p class="lesson-description" *ngIf="currentLesson.description">
        {{ currentLesson.description }}
      </p>

      <div class="chapter-context">
        <span class="chapter-label">Ch∆∞∆°ng:</span>
        <span class="chapter-name">{{ currentChapter?.title }}</span>
      </div>
    </div>

    <!-- Main Content Area -->
    <div class="content-area">
      
      <!-- Video Content -->
      <div class="video-section" 
           *ngIf="currentLesson.lessonType === 'VIDEO'">
        
        <div class="video-container">
          <div class="video-player" *ngIf="currentLesson.contentUrl; else videoPlaceholder">
            <video #videoPlayer 
                   class="lesson-video"
                   [src]="currentLesson.contentUrl"
                   controls
                   preload="metadata"
                   (loadedmetadata)="onVideoLoaded()"
                   (timeupdate)="onVideoProgress($event)"
                   (ended)="onVideoEnded()">
              <source [src]="currentLesson.contentUrl" type="video/mp4">
              Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ video HTML5.
            </video>
            
            <!-- Video Controls Overlay -->
            <div class="video-controls-overlay" [class.visible]="showVideoControls">
              <div class="playback-controls">
                <button type="button" 
                        class="control-btn play-pause-btn"
                        (click)="togglePlayPause()">
                  {{ isVideoPlaying ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è' }}
                </button>
                
                <div class="time-display">
                  {{ formatTime(currentVideoTime) }} / {{ formatTime(videoDuration) }}
                </div>
                
                <div class="speed-control">
                  <select class="speed-select" 
                          [(ngModel)]="playbackSpeed"
                          (change)="changePlaybackSpeed()">
                    <option value="0.5">0.5x</option>
                    <option value="0.75">0.75x</option>
                    <option value="1">1x</option>
                    <option value="1.25">1.25x</option>
                    <option value="1.5">1.5x</option>
                    <option value="2">2x</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
          
          <ng-template #videoPlaceholder>
            <div class="video-placeholder">
              <div class="placeholder-content">
                <span class="placeholder-icon">üé•</span>
                <h3 class="placeholder-title">Video ƒëang ƒë∆∞·ª£c chu·∫©n b·ªã</h3>
                <p class="placeholder-text">N·ªôi dung video s·∫Ω s·ªõm ƒë∆∞·ª£c c·∫≠p nh·∫≠t</p>
              </div>
            </div>
          </ng-template>
        </div>

        <!-- Video Notes -->
        <div class="video-notes">
          <div class="notes-header">
            <h3 class="notes-title">üìù Ghi ch√∫ video</h3>
            <button type="button" 
                    class="btn btn-secondary btn-small"
                    (click)="addNote()">
              Th√™m ghi ch√∫
            </button>
          </div>
          
          <div class="notes-list" *ngIf="videoNotes.length > 0">
            <div *ngFor="let note of videoNotes; let i = index" class="note-item">
              <div class="note-time" (click)="seekToTime(note.timestamp)">
                {{ formatTime(note.timestamp) }}
              </div>
              <div class="note-content">
                <p class="note-text">{{ note.content }}</p>
                <button type="button" 
                        class="delete-note-btn"
                        (click)="deleteNote(i)">
                  üóëÔ∏è
                </button>
              </div>
            </div>
          </div>
          
          <div class="no-notes" *ngIf="videoNotes.length === 0">
            <span class="no-notes-text">Ch∆∞a c√≥ ghi ch√∫ n√†o</span>
          </div>
        </div>
      </div>

      <!-- Document Content -->
      <div class="document-section" 
           *ngIf="currentLesson.lessonType === 'DOCUMENT'">
        
        <div class="document-container">
          <div class="document-viewer" *ngIf="currentLesson.contentUrl; else documentPlaceholder">
            
            <!-- PDF Viewer -->
            <div class="pdf-viewer" *ngIf="isPdfDocument">
              <embed [src]="currentLesson.contentUrl" 
                     type="application/pdf" 
                     class="pdf-embed">
              
              <!-- PDF Controls -->
              <div class="pdf-controls">
                <button type="button" 
                        class="btn btn-secondary"
                        (click)="downloadDocument()">
                  üì• T·∫£i xu·ªëng
                </button>
                <button type="button" 
                        class="btn btn-secondary"
                        (click)="openDocumentFullscreen()">
                  üîç To√†n m√†n h√¨nh
                </button>
              </div>
            </div>
            
            <!-- Text Document -->
            <div class="text-document" *ngIf="!isPdfDocument">
              <div class="document-content" [innerHTML]="documentContent"></div>
            </div>
          </div>
          
          <ng-template #documentPlaceholder>
            <div class="document-placeholder">
              <div class="placeholder-content">
                <span class="placeholder-icon">üìÑ</span>
                <h3 class="placeholder-title">T√†i li·ªáu ƒëang ƒë∆∞·ª£c chu·∫©n b·ªã</h3>
                <p class="placeholder-text">N·ªôi dung t√†i li·ªáu s·∫Ω s·ªõm ƒë∆∞·ª£c c·∫≠p nh·∫≠t</p>
              </div>
            </div>
          </ng-template>
        </div>

        <!-- Document Summary -->
        <div class="document-summary">
          <h3 class="summary-title">üìã T√≥m t·∫Øt n·ªôi dung</h3>
          <div class="summary-content">
            <ul class="summary-points">
              <li>C√°c kh√°i ni·ªám c∆° b·∫£n v√† ƒë·ªãnh nghƒ©a quan tr·ªçng</li>
              <li>V√≠ d·ª• th·ª±c t·∫ø v√† case study</li>
              <li>B√†i t·∫≠p v√† c√¢u h·ªèi th·∫£o lu·∫≠n</li>
              <li>T√†i li·ªáu tham kh·∫£o b·ªï sung</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Quiz Content -->
      <div class="quiz-section" 
           *ngIf="currentLesson.lessonType === 'QUIZ'">
        
        <div class="quiz-container">
          <div class="quiz-header">
            <h3 class="quiz-title">üéØ B√†i ki·ªÉm tra</h3>
            <div class="quiz-info">
              <span class="question-counter">
                C√¢u {{ currentQuestionIndex + 1 }} / {{ quizQuestions.length }}
              </span>
              <span class="quiz-score" *ngIf="quizCompleted">
                ƒêi·ªÉm: {{ quizScore }} / {{ quizQuestions.length }}
              </span>
            </div>
          </div>

          <!-- Quiz Questions -->
          <div class="quiz-content" *ngIf="!quizCompleted">
            <div class="question-container" *ngIf="currentQuestion">
              <h4 class="question-text">{{ currentQuestion.question }}</h4>
              
              <div class="answers-list">
                <label *ngFor="let answer of currentQuestion.answers; let i = index" 
                       class="answer-option"
                       [class.selected]="selectedAnswer === i">
                  <input type="radio" 
                         [name]="'question-' + currentQuestionIndex"
                         [value]="i"
                         [(ngModel)]="selectedAnswer"
                         class="answer-radio">
                  <span class="answer-text">{{ answer.text }}</span>
                </label>
              </div>

              <div class="question-actions">
                <button type="button" 
                        class="btn btn-secondary"
                        (click)="previousQuestion()"
                        [disabled]="currentQuestionIndex === 0">
                  C√¢u tr∆∞·ªõc
                </button>
                
                <button type="button" 
                        class="btn btn-primary"
                        (click)="nextQuestion()"
                        [disabled]="selectedAnswer === null">
                  {{ isLastQuestion ? 'Ho√†n th√†nh' : 'C√¢u ti·∫øp theo' }}
                </button>
              </div>
            </div>
          </div>

          <!-- Quiz Results -->
          <div class="quiz-results" *ngIf="quizCompleted">
            <div class="results-summary">
              <div class="score-display">
                <div class="score-circle" [class]="getScoreClass()">
                  <span class="score-text">{{ getScorePercentage() }}%</span>
                </div>
                <h4 class="score-label">{{ getScoreMessage() }}</h4>
              </div>
              
              <div class="results-details">
                <div class="detail-item">
                  <span class="detail-label">ƒê√∫ng:</span>
                  <span class="detail-value correct">{{ quizScore }} / {{ quizQuestions.length }}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Sai:</span>
                  <span class="detail-value incorrect">{{ quizQuestions.length - quizScore }} / {{ quizQuestions.length }}</span>
                </div>
              </div>

              <div class="results-actions">
                <button type="button" 
                        class="btn btn-secondary"
                        (click)="retakeQuiz()">
                  üîÑ L√†m l·∫°i
                </button>
                <button type="button" 
                        class="btn btn-primary"
                        (click)="continueToNextLesson()"
                        [disabled]="!hasNextLesson">
                  Ti·∫øp t·ª•c
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Lesson Actions -->
    <div class="lesson-actions">
      <div class="completion-section">
        <label class="completion-checkbox">
          <input type="checkbox" 
                 [(ngModel)]="isLessonCompleted"
                 (change)="toggleLessonCompletion()"
                 class="checkbox-input">
          <span class="checkbox-custom"></span>
          <span class="checkbox-text">ƒê√°nh d·∫•u ho√†n th√†nh b√†i h·ªçc</span>
        </label>
      </div>

      <div class="action-buttons">
        <button type="button" 
                class="btn btn-outline"
                (click)="bookmarkLesson()">
          <span class="btn-icon">{{ isBookmarked ? '‚≠ê' : '‚òÜ' }}</span>
          {{ isBookmarked ? 'ƒê√£ l∆∞u' : 'L∆∞u b√†i h·ªçc' }}
        </button>
        
        <button type="button" 
                class="btn btn-secondary"
                (click)="shareLesson()">
          <span class="btn-icon">üì§</span>
          Chia s·∫ª
        </button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="loading-spinner"></div>
    <p class="loading-text">ƒêang t·∫£i n·ªôi dung b√†i h·ªçc...</p>
  </div>
</div>

<!-- Add Note Modal -->
<div *ngIf="showAddNoteModal" class="modal-overlay" (click)="closeAddNoteModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2 class="modal-title">üìù Th√™m ghi ch√∫</h2>
      <button type="button" class="close-btn" (click)="closeAddNoteModal()">‚úï</button>
    </div>
    
    <div class="modal-body">
      <div class="form-group">
        <label class="form-label">Th·ªùi ƒëi·ªÉm:</label>
        <span class="time-display">{{ formatTime(currentVideoTime) }}</span>
      </div>
      
      <div class="form-group">
        <label for="noteContent" class="form-label">N·ªôi dung ghi ch√∫:</label>
        <textarea id="noteContent"
                  class="form-textarea"
                  [(ngModel)]="newNoteContent"
                  placeholder="Nh·∫≠p n·ªôi dung ghi ch√∫..."
                  rows="4"></textarea>
      </div>
    </div>
    
    <div class="modal-actions">
      <button type="button" 
              class="btn btn-outline" 
              (click)="closeAddNoteModal()">
        H·ªßy
      </button>
      <button type="button" 
              class="btn btn-primary"
              (click)="saveNote()"
              [disabled]="!newNoteContent.trim()">
        L∆∞u ghi ch√∫
      </button>
    </div>
  </div>
</div>