<!-- Enrollment History Component -->
<div class="enrollment-history-page">
  <!-- Header Section -->
  <div class="page-header">
    <button class="back-btn" (click)="goBack()">
      <i class="icon">â†</i>
      QUAY Láº I
    </button>
    <div class="header-content">
      <h1 class="page-title">Lá»ŠCH Sá»¬ ÄÄ‚NG KÃ</h1>
      <p class="page-subtitle">Theo dÃµi toÃ n bá»™ lá»‹ch sá»­ Ä‘Äƒng kÃ½ vÃ  hoáº¡t Ä‘á»™ng há»c táº­p</p>
    </div>
    <div class="header-stats">
      <div class="stat-item">
        <span class="stat-number">{{ totalEnrollments }}</span>
        <span class="stat-label">Tá»”NG ÄÄ‚NG KÃ</span>
      </div>
    </div>
    </div>

  <!-- Filter Controls -->
  <div class="filter-section">
    <div class="filter-controls">
      <select class="filter-select" [(ngModel)]="statusFilter" (change)="applyFilters()">
        <option value="">Táº¤T Cáº¢ TRáº NG THÃI</option>
        <option value="ACTIVE">ACTIVE</option>
        <option value="COMPLETED">HOÃ€N THÃ€NH</option>
        <option value="CANCELLED">ÄÃƒ Há»¦Y</option>
      </select>

      <select class="filter-select" [(ngModel)]="timeFilter" (change)="applyFilters()">
        <option value="">Táº¤T Cáº¢ THá»œI GIAN</option>
        <option value="thisMonth">THÃNG NÃ€Y</option>
        <option value="lastMonth">THÃNG TRÆ¯á»šC</option>
        <option value="thisYear">NÄ‚M NAY</option>
        <option value="lastYear">NÄ‚M TRÆ¯á»šC</option>
      </select>

      <select class="filter-select" [(ngModel)]="categoryFilter" (change)="applyFilters()">
        <option value="">Táº¤T Cáº¢ DANH Má»¤C</option>
        <option value="Láº­p trÃ¬nh">Láº¬P TRÃŒNH</option>
        <option value="Design">THIáº¾T Káº¾</option>
        <option value="Marketing">MARKETING</option>
        <option value="Business">KINH DOANH</option>
      </select>

      <button class="export-btn" (click)="exportHistory()">
        <i class="icon">ğŸ“Š</i>
        XUáº¤T BÃO CÃO
      </button>
    </div>

    <div class="summary-stats">
      <div class="summary-card active">
        <div class="summary-icon">ğŸ¯</div>
        <div class="summary-info">
          <span class="summary-number">{{ getActiveCount() }}</span>
          <span class="summary-label">ACTIVE</span>
        </div>
      </div>
      <div class="summary-card completed">
        <div class="summary-icon">ğŸ†</div>
        <div class="summary-info">
          <span class="summary-number">{{ getCompletedCount() }}</span>
          <span class="summary-label">COMPLETED</span>
        </div>
      </div>
      <div class="summary-card cancelled">
        <div class="summary-icon">âŒ</div>
        <div class="summary-info">
          <span class="summary-number">{{ getCancelledCount() }}</span>
          <span class="summary-label">ÄÃ£ há»§y</span>
        </div>
      </div>
      <div class="summary-card total-time">
        <div class="summary-icon">â°</div>
        <div class="summary-info">
          <span class="summary-number">{{ getTotalStudyTime() }}h</span>
          <span class="summary-label">Tá»•ng giá» há»c</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Timeline View -->
  <div class="timeline-container">
    <div class="timeline-header">
      <h3 class="timeline-title">
        <i class="icon">ğŸ“…</i>
        DÃ’NG THá»œI GIAN ÄÄ‚NG KÃ
      </h3>
      <div class="view-toggle">
        <button 
          class="toggle-btn"
          [class.active]="viewMode === 'timeline'"
          (click)="setViewMode('timeline')"
        >
          <i class="icon">ğŸ“…</i>
          TIMELINE
        </button>
        <button 
          class="toggle-btn"
          [class.active]="viewMode === 'grid'"
          (click)="setViewMode('grid')"
        >
          <i class="icon">ğŸ“Š</i>
          GRID
        </button>
      </div>
    </div>

    <!-- Timeline View -->
    <div class="timeline-view" *ngIf="viewMode === 'timeline'">
      <div class="timeline-line"></div>
      <div 
        class="timeline-item" 
        *ngFor="let entry of filteredHistory; let i = index"
        [class]="entry.status.toLowerCase()"
      >
        <div class="timeline-marker">
          <div class="marker-dot"></div>
          <div class="marker-date">{{ formatDate(entry.date) }}</div>
        </div>
        
        <div class="timeline-content">
          <div class="timeline-card">
            <div class="card-header">
              <div class="course-thumbnail">
                <img [src]="entry.course.thumbnail" [alt]="entry.course.title">
                <div class="status-badge" [class]="entry.status.toLowerCase()">
                  {{ getStatusText(entry.status) }}
                </div>
              </div>
              <div class="course-info">
                <h4 class="course-title">{{ entry.course.title }}</h4>
                <p class="course-instructor">{{ entry.course.instructor }}</p>
                <div class="entry-details">
                  <span class="entry-type">{{ getActionText(entry.action) }}</span>
                  <span class="entry-time">{{ formatTime(entry.date) }}</span>
                </div>
              </div>
              <div class="entry-price" *ngIf="entry.amount">
                <span class="price-amount">{{ formatPrice(entry.amount) }}</span>
                <span class="price-label">ÄÃ£ thanh toÃ¡n</span>
              </div>
            </div>

            <div class="card-body" *ngIf="entry.description">
              <p class="entry-description">{{ entry.description }}</p>
            </div>

            <div class="card-actions" *ngIf="entry.status === 'ACTIVE'">
              <button 
                class="btn btn-small btn-primary"
                [routerLink]="['/courses', entry.course.id]"
              >
                <i class="icon">ğŸ“š</i>
                XEM KHÃ“A Há»ŒC
              </button>
              <button 
                class="btn btn-small btn-secondary"
                [routerLink]="['/enrollments', entry.id]"
              >
                <i class="icon">ğŸ“Š</i>
                CHI TIáº¾T
              </button>
            </div>

            <div class="progress-section" *ngIf="entry.progress !== undefined">
              <div class="progress-info">
                <span class="progress-label">Tiáº¿n Ä‘á»™:</span>
                <span class="progress-percentage">{{ entry.progress }}%</span>
              </div>
              <div class="progress-bar">
                <div 
                  class="progress-fill"
                  [style.width.%]="entry.progress"
                ></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Grid View -->
    <div class="grid-view" *ngIf="viewMode === 'grid'">
      <div class="history-grid">
        <div 
          class="history-card"
          *ngFor="let entry of filteredHistory"
          [class]="entry.status.toLowerCase()"
        >
          <div class="card-header">
            <div class="course-image">
              <img [src]="entry.course.thumbnail" [alt]="entry.course.title">
              <div class="status-overlay" [class]="entry.status.toLowerCase()">
                {{ getStatusText(entry.status) }}
              </div>
            </div>
          </div>

          <div class="card-content">
            <h4 class="course-title">{{ entry.course.title }}</h4>
            <p class="course-instructor">{{ entry.course.instructor }}</p>
            
            <div class="entry-meta">
              <div class="meta-row">
                <span class="meta-label">HÃ nh Ä‘á»™ng:</span>
                <span class="meta-value">{{ getActionText(entry.action) }}</span>
              </div>
              <div class="meta-row">
                <span class="meta-label">NgÃ y:</span>
                <span class="meta-value">{{ formatDate(entry.date) }}</span>
              </div>
              <div class="meta-row" *ngIf="entry.amount">
                <span class="meta-label">Sá»‘ tiá»n:</span>
                <span class="meta-value price">{{ formatPrice(entry.amount) }}</span>
              </div>
              <div class="meta-row" *ngIf="entry.progress !== undefined">
                <span class="meta-label">Tiáº¿n Ä‘á»™:</span>
                <span class="meta-value">{{ entry.progress }}%</span>
              </div>
            </div>

            <div class="progress-bar" *ngIf="entry.progress !== undefined">
              <div 
                class="progress-fill"
                [style.width.%]="entry.progress"
              ></div>
            </div>
          </div>

          <div class="card-actions">
            <button 
              class="btn btn-small btn-outline"
              [routerLink]="['/courses', entry.course.id]"
              *ngIf="entry.status === 'ACTIVE'"
            >
              XEM KHÃ“A Há»ŒC
            </button>
            <button 
              class="btn btn-small btn-primary"
              [routerLink]="['/enrollments', entry.id]"
              *ngIf="entry.status === 'ACTIVE'"
            >
              CHI TIáº¾T
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="filteredHistory.length === 0">
    <div class="empty-icon">ğŸ“</div>
    <h3 class="empty-title">CHÆ¯A CÃ“ Lá»ŠCH Sá»¬</h3>
    <p class="empty-message">
      KhÃ´ng tÃ¬m tháº¥y lá»‹ch sá»­ Ä‘Äƒng kÃ½ nÃ o phÃ¹ há»£p vá»›i bá»™ lá»c cá»§a báº¡n.
    </p>
    <button class="btn btn-primary" (click)="resetFilters()">
      <i class="icon">ğŸ”„</i>
      Äáº¶T Láº I Bá»˜ Lá»ŒC
    </button>
  </div>

  <!-- Pagination -->
  <div class="pagination-container" *ngIf="filteredHistory.length > itemsPerPage">
    <div class="pagination-info">
      Hiá»ƒn thá»‹ {{ (currentPage - 1) * itemsPerPage + 1 }}-{{ Math.min(currentPage * itemsPerPage, filteredHistory.length) }}
      trong tá»•ng sá»‘ {{ filteredHistory.length }} báº£n ghi
    </div>
    <div class="pagination">
      <button
        class="btn btn-outline"
        [disabled]="currentPage === 1"
        (click)="goToPage(currentPage - 1)"
      >
        â—€ï¸ TRÆ¯á»šC
      </button>
      <button
        class="btn"
        *ngFor="let page of getPageNumbers()"
        [class.active]="page === currentPage"
        (click)="goToPage(page)"
      >
        {{ page }}
      </button>
      <button
        class="btn btn-outline"
        [disabled]="currentPage === totalPages"
        (click)="goToPage(currentPage + 1)"
      >
        SAU â–¶ï¸
      </button>
    </div>
  </div>

  <!-- Quick Statistics Panel -->
  <div class="quick-stats-panel">
    <h3 class="panel-title">
      <i class="icon">ğŸ“ˆ</i>
      THá»NG KÃŠ NHANH
    </h3>
    <div class="stats-grid">
      <div class="stat-box">
        <div class="stat-icon">ğŸ“š</div>
        <div class="stat-info">
          <span class="stat-number">{{ getMonthlyEnrollments() }}</span>
          <span class="stat-label">ÄÄƒng kÃ½ thÃ¡ng nÃ y</span>
        </div>
      </div>
      <div class="stat-box">
        <div class="stat-icon">ğŸ’°</div>
        <div class="stat-info">
          <span class="stat-number">{{ formatPrice(getTotalSpent()) }}</span>
          <span class="stat-label">Tá»•ng chi tiÃªu</span>
        </div>
      </div>
      <div class="stat-box">
        <div class="stat-icon">ğŸ¯</div>
        <div class="stat-info">
          <span class="stat-number">{{ getAverageProgress() }}%</span>
          <span class="stat-label">Tiáº¿n Ä‘á»™ trung bÃ¬nh</span>
        </div>
      </div>
      <div class="stat-box">
        <div class="stat-icon">ğŸ”¥</div>
        <div class="stat-info">
          <span class="stat-number">{{ getLongestStreak() }}</span>
          <span class="stat-label">Chuá»—i há»c dÃ i nháº¥t</span>
        </div>
      </div>
    </div>
  </div>
</div>