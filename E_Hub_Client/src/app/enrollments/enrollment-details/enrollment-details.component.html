<!-- Enrollment Details Component -->
<div class="enrollment-details-page">
  <!-- Header Section -->
  <div class="page-header">
    <button class="back-btn" (click)="goBack()">
      <i class="icon">â†</i>
      QUAY Láº I
    </button>
    <div class="header-content">
      <h1 class="page-title">CHI TIáº¾T ÄÄ‚NG KÃ</h1>
      <div class="enrollment-badge" [class]="enrollment?.status?.toLowerCase()">
        {{ enrollment?.status === 'ACTIVE' ? 'ACTIVE' : 'COMPLETED' }}
      </div>
    </div>
    <div class="header-actions">
      <button 
        class="btn btn-primary"
        [routerLink]="['/courses', enrollment?.course?.id, 'lessons', enrollment?.nextLessonId]"
        *ngIf="enrollment?.status === 'ACTIVE' && enrollment?.nextLessonId"
      >
        <i class="icon">â–¶ï¸</i>
        TIáº¾P Tá»¤C Há»ŒC
      </button>
    </div>
  </div>

  <div class="content-container" *ngIf="enrollment">
    <!-- Course Overview Card -->
    <div class="course-overview-card">
      <div class="course-thumbnail">
        <img [src]="enrollment.course.thumbnail" [alt]="enrollment.course.title">
        <div class="progress-overlay">
          <div class="progress-circle-large">
            <svg class="progress-ring" width="120" height="120">
              <circle
                class="progress-ring-circle"
                stroke="currentColor"
                stroke-width="8"
                fill="transparent"
                r="52"
                cx="60"
                cy="60"
                [style.stroke-dasharray]="2 * Math.PI * 52"
                [style.stroke-dashoffset]="2 * Math.PI * 52 * (1 - enrollment.progress / 100)"
              />
            </svg>
            <div class="progress-text-large">
              <span class="percentage">{{ enrollment.progress }}%</span>
              <span class="label">HOÃ€N THÃ€NH</span>
            </div>
          </div>
        </div>
      </div>
      
      <div class="course-info">
        <h2 class="course-title">{{ enrollment.course.title }}</h2>
        <p class="course-instructor">
          <i class="icon">ğŸ‘¨â€ğŸ«</i>
          Giáº£ng viÃªn: {{ enrollment.course.instructor }}
        </p>
        <p class="course-description">{{ enrollment.course.description }}</p>
        
        <div class="course-meta">
          <div class="meta-grid">
            <div class="meta-item">
              <i class="icon">ğŸ“…</i>
              <span class="meta-label">NgÃ y Ä‘Äƒng kÃ½:</span>
              <span class="meta-value">{{ formatDate(enrollment.enrolledAt) }}</span>
            </div>
            <div class="meta-item" *ngIf="enrollment.lastAccessed">
              <i class="icon">ğŸ‘ï¸</i>
              <span class="meta-label">Truy cáº­p cuá»‘i:</span>
              <span class="meta-value">{{ formatDate(enrollment.lastAccessed) }}</span>
            </div>
            <div class="meta-item">
              <i class="icon">ğŸ“š</i>
              <span class="meta-label">BÃ i há»c:</span>
              <span class="meta-value">{{ enrollment.completedLessons }}/{{ enrollment.totalLessons }}</span>
            </div>
            <div class="meta-item">
              <i class="icon">â±ï¸</i>
              <span class="meta-label">Thá»i gian há»c:</span>
              <span class="meta-value">{{ enrollment.studyTime }} giá»</span>
            </div>
            <div class="meta-item">
              <i class="icon">ğŸ¯</i>
              <span class="meta-label">Cáº¥p Ä‘á»™:</span>
              <span class="meta-value">{{ getLevelText(enrollment.course.level) }}</span>
            </div>
            <div class="meta-item">
              <i class="icon">ğŸ“‚</i>
              <span class="meta-label">Danh má»¥c:</span>
              <span class="meta-value">{{ enrollment.course.category }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="details-grid">
      <!-- Progress Statistics -->
      <div class="progress-stats-card">
        <h3 class="card-title">
          <i class="icon">ğŸ“Š</i>
          THá»NG KÃŠ TIáº¾N Äá»˜
        </h3>
        
        <div class="stats-grid">
          <div class="stat-item">
            <div class="stat-icon">ğŸ¯</div>
            <div class="stat-info">
              <div class="stat-number">{{ enrollment.progress }}%</div>
              <div class="stat-label">HoÃ n thÃ nh</div>
            </div>
          </div>
          <div class="stat-item">
            <div class="stat-icon">ğŸ“š</div>
            <div class="stat-info">
              <div class="stat-number">{{ enrollment.completedLessons }}</div>
              <div class="stat-label">BÃ i Ä‘Ã£ há»c</div>
            </div>
          </div>
          <div class="stat-item">
            <div class="stat-icon">â°</div>
            <div class="stat-info">
              <div class="stat-number">{{ enrollment.studyTime }}h</div>
              <div class="stat-label">Thá»i gian</div>
            </div>
          </div>
          <div class="stat-item">
            <div class="stat-icon">ğŸ†</div>
            <div class="stat-info">
              <div class="stat-number">{{ achievements.length }}</div>
              <div class="stat-label">ThÃ nh tÃ­ch</div>
            </div>
          </div>
        </div>

        <!-- Progress Bar -->
        <div class="progress-section">
          <div class="progress-header">
            <span class="progress-label">TIáº¾N Äá»˜ Tá»”NG QUAN</span>
            <span class="progress-percentage">{{ enrollment.progress }}%</span>
          </div>
          <div class="progress-bar">
            <div 
              class="progress-fill" 
              [style.width.%]="enrollment.progress"
            ></div>
          </div>
          <div class="progress-milestones">
            <div class="milestone" [class.completed]="enrollment.progress >= 25">25%</div>
            <div class="milestone" [class.completed]="enrollment.progress >= 50">50%</div>
            <div class="milestone" [class.completed]="enrollment.progress >= 75">75%</div>
            <div class="milestone" [class.completed]="enrollment.progress >= 100">100%</div>
          </div>
        </div>

        <!-- Study Streak -->
        <div class="study-streak" *ngIf="studyStreak > 0">
          <div class="streak-icon">ğŸ”¥</div>
          <div class="streak-info">
            <div class="streak-number">{{ studyStreak }}</div>
            <div class="streak-label">NGÃ€Y LIÃŠN Tá»¤C</div>
          </div>
        </div>
      </div>

      <!-- Learning Path -->
      <div class="learning-path-card">
        <h3 class="card-title">
          <i class="icon">ğŸ—ºï¸</i>
          Lá»˜ TRÃŒNH Há»ŒC Táº¬P
        </h3>
        
        <div class="chapters-list">
          <div 
            class="chapter-item" 
            *ngFor="let chapter of chapters; let i = index"
            [class.completed]="chapter.completed"
            [class.current]="chapter.isCurrent"
          >
            <div class="chapter-header" (click)="toggleChapter(chapter)">
              <div class="chapter-status">
                <i class="icon" 
                   [class]="chapter.completed ? 'completed' : chapter.isCurrent ? 'current' : 'pending'">
                  {{ chapter.completed ? 'âœ…' : chapter.isCurrent ? 'â–¶ï¸' : 'â³' }}
                </i>
              </div>
              <div class="chapter-info">
                <h4 class="chapter-title">{{ chapter.title }}</h4>
                <p class="chapter-progress">{{ chapter.completedLessons }}/{{ chapter.totalLessons }} bÃ i há»c</p>
              </div>
              <div class="chapter-toggle">
                <i class="icon">{{ chapter.expanded ? 'â–¼' : 'â–¶' }}</i>
              </div>
            </div>

            <div class="lessons-list" *ngIf="chapter.expanded">
              <div 
                class="lesson-item" 
                *ngFor="let lesson of chapter.lessons"
                [class.completed]="lesson.completed"
                [class.current]="lesson.isCurrent"
              >
                <div class="lesson-status">
                  <i class="icon">{{ lesson.completed ? 'âœ…' : lesson.isCurrent ? 'â–¶ï¸' : 'â³' }}</i>
                </div>
                <div class="lesson-info">
                  <span class="lesson-title">{{ lesson.title }}</span>
                  <span class="lesson-duration">{{ lesson.duration }} phÃºt</span>
                </div>
                <button 
                  class="lesson-action"
                  [routerLink]="['/courses', enrollment.course.id, 'lessons', lesson.id]"
                  [disabled]="!lesson.accessible"
                >
                  {{ lesson.completed ? 'XEM Láº I' : lesson.isCurrent ? 'TIáº¾P Tá»¤C' : 'KHÃ“A' }}
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Achievements -->
      <div class="achievements-card">
        <h3 class="card-title">
          <i class="icon">ğŸ†</i>
          THÃ€NH TÃCH Äáº T ÄÆ¯á»¢C
        </h3>
        
        <div class="achievements-grid">
          <div 
            class="achievement-item" 
            *ngFor="let achievement of achievements"
            [class.unlocked]="achievement.unlocked"
          >
            <div class="achievement-icon">{{ achievement.icon }}</div>
            <div class="achievement-info">
              <h4 class="achievement-title">{{ achievement.title }}</h4>
              <p class="achievement-description">{{ achievement.description }}</p>
              <div class="achievement-date" *ngIf="achievement.unlockedAt">
                Äáº¡t Ä‘Æ°á»£c: {{ formatDate(achievement.unlockedAt) }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Study Calendar -->
      <div class="study-calendar-card">
        <h3 class="card-title">
          <i class="icon">ğŸ“…</i>
          Lá»ŠCH Há»ŒC Táº¬P
        </h3>
        
        <div class="calendar-stats">
          <div class="calendar-stat">
            <span class="stat-number">{{ getStudyDaysThisMonth() }}</span>
            <span class="stat-label">NgÃ y há»c thÃ¡ng nÃ y</span>
          </div>
          <div class="calendar-stat">
            <span class="stat-number">{{ studyStreak }}</span>
            <span class="stat-label">NgÃ y liÃªn tá»¥c</span>
          </div>
        </div>

        <div class="calendar-grid">
          <div 
            class="calendar-day" 
            *ngFor="let day of calendarDays"
            [class.has-study]="day.hasStudy"
            [class.today]="day.isToday"
            [title]="day.studyTime ? day.studyTime + ' phÃºt há»c' : ''"
          >
            {{ day.day }}
          </div>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="action-section">
      <button 
        class="btn btn-primary"
        [routerLink]="['/courses', enrollment.course.id]"
      >
        <i class="icon">ğŸ </i>
        TRANG KHÃ“A Há»ŒC
      </button>
      <button 
        class="btn btn-secondary"
        [routerLink]="['/courses', enrollment.course.id, 'lessons', enrollment.nextLessonId]"
        *ngIf="enrollment.status === 'ACTIVE' && enrollment.nextLessonId"
      >
        <i class="icon">â–¶ï¸</i>
        TIáº¾P Tá»¤C Há»ŒC
      </button>
      <button 
        class="btn btn-accent"
        (click)="downloadCertificate()"
        *ngIf="enrollment.status === 'COMPLETED'"
      >
        <i class="icon">ğŸ†</i>
        Táº¢I CHá»¨NG CHá»ˆ
      </button>
      <button 
        class="btn btn-outline"
        (click)="shareProgress()"
      >
        <i class="icon">ğŸ“¤</i>
        CHIA Sáºº TIáº¾N Äá»˜
      </button>
      <button 
        class="btn btn-outline"
        (click)="exportProgressReport()"
      >
        <i class="icon">ğŸ“Š</i>
        XUáº¤T BÃO CÃO
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="!enrollment">
    <div class="loading-spinner">
      <div class="spinner"></div>
      <p>ÄANG Táº¢I THÃ”NG TIN...</p>
    </div>
  </div>
</div>