<!-- Admin User Management Template -->
<div class="admin-container">
  <!-- Decorative Elements -->
  <div class="geometric-decoration decoration-1"></div>
  <div class="geometric-decoration decoration-2"></div>
  <div class="geometric-decoration decoration-3"></div>

  <!-- Header Section -->
  <div class="admin-header">
    <div class="header-content">
      <h1 class="page-title">üë• Qu·∫£n l√Ω ng∆∞·ªùi d√πng</h1>
      <p class="page-subtitle">Qu·∫£n tr·ªã vi√™n c√≥ th·ªÉ xem, ch·ªânh s·ª≠a v√† qu·∫£n l√Ω t·∫•t c·∫£ ng∆∞·ªùi d√πng trong h·ªá th·ªëng</p>
    </div>
    
    <div class="header-actions">
      <button type="button" 
              class="btn btn-primary"
              (click)="showCreateModal = true">
        <span class="btn-icon">‚ûï</span>
        T·∫°o ng∆∞·ªùi d√πng m·ªõi
      </button>
      
      <button type="button" 
              class="btn btn-secondary"
              (click)="exportUsers()">
        <span class="btn-icon">üìä</span>
        Xu·∫•t danh s√°ch
      </button>
    </div>
  </div>

  <!-- Filters and Search -->
  <div class="filters-section">
    <div class="search-group">
      <input type="text" 
             [(ngModel)]="searchQuery"
             (ngModelChange)="onSearch()"
             class="search-input"
             placeholder="üîç T√¨m ki·∫øm theo t√™n ho·∫∑c email...">
    </div>
    
    <div class="filter-group">
      <select [(ngModel)]="selectedRole" (ngModelChange)="onFilterChange()" class="filter-select">
        <option value="">T·∫•t c·∫£ vai tr√≤</option>
        <option value="USER">H·ªçc vi√™n</option>
        <option value="ADMIN">Qu·∫£n tr·ªã vi√™n</option>
        <option value="SUPER_ADMIN">Qu·∫£n tr·ªã c·∫•p cao</option>
      </select>
      
      <select [(ngModel)]="selectedStatus" (ngModelChange)="onFilterChange()" class="filter-select">
        <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
        <option value="ACTIVE">Ho·∫°t ƒë·ªông</option>
        <option value="SUSPENDED">T·∫°m kh√≥a</option>
        <option value="DELETED">ƒê√£ x√≥a</option>
      </select>
    </div>
    
    <div class="stats-display">
      <div class="stat-item">
        <span class="stat-number">{{ totalUsers }}</span>
        <span class="stat-label">T·ªïng s·ªë</span>
      </div>
      <div class="stat-item">
        <span class="stat-number">{{ activeUsers }}</span>
        <span class="stat-label">Ho·∫°t ƒë·ªông</span>
      </div>
      <div class="stat-item">
        <span class="stat-number">{{ suspendedUsers }}</span>
        <span class="stat-label">T·∫°m kh√≥a</span>
      </div>
    </div>
  </div>

  <!-- Users Table -->
  <div class="table-container">
    <div class="table-header">
      <h2 class="table-title">Danh s√°ch ng∆∞·ªùi d√πng</h2>
      <div class="table-controls">
        <span class="showing-text">
          Hi·ªÉn th·ªã {{ (currentPage - 1) * pageSize + 1 }} - 
          {{ getEndIndex() }} 
          trong t·ªïng s·ªë {{ totalUsers }} ng∆∞·ªùi d√πng
        </span>
      </div>
    </div>

    <div class="users-table" *ngIf="!isLoading">
      <!-- Table Header -->
      <div class="table-row header-row">
        <div class="table-cell">Th√¥ng tin</div>
        <div class="table-cell">Vai tr√≤</div>
        <div class="table-cell">Tr·∫°ng th√°i</div>
        <div class="table-cell">ƒêƒÉng nh·∫≠p cu·ªëi</div>
        <div class="table-cell">Thao t√°c</div>
      </div>

      <!-- Table Body -->
      <div *ngFor="let user of users; trackBy: trackByUserId" class="table-row data-row">
        
        <!-- User Info -->
        <div class="table-cell user-info">
          <div class="user-avatar">
            <img [src]="user.avatarUrl || defaultAvatar" [alt]="user.fullName" class="avatar-image">
          </div>
          <div class="user-details">
            <div class="user-name">{{ user.fullName }}</div>
            <div class="user-email">{{ user.email }}</div>
            <div class="user-id">ID: {{ user.id }}</div>
          </div>
        </div>

        <!-- Role -->
        <div class="table-cell">
          <span class="role-badge" [class]="'role-' + user.role.toLowerCase()">
            {{ getRoleDisplay(user.role) }}
          </span>
        </div>

        <!-- Status -->
        <div class="table-cell">
          <span class="status-badge" [class]="'status-' + user.status.toLowerCase()">
            {{ getStatusDisplay(user.status) }}
          </span>
        </div>

        <!-- Last Login -->
        <div class="table-cell last-login">
          <div class="login-time">{{ formatDate(user.lastLoginAt) }}</div>
          <div class="login-relative">{{ getRelativeTime(user.lastLoginAt) }}</div>
        </div>

        <!-- Actions -->
        <div class="table-cell actions">
          <button type="button" 
                  class="action-btn view-btn"
                  (click)="viewUser(user)"
                  title="Xem chi ti·∫øt">
            üëÅÔ∏è
          </button>
          
          <button type="button" 
                  class="action-btn edit-btn"
                  (click)="editUser(user)"
                  title="Ch·ªânh s·ª≠a">
            ‚úèÔ∏è
          </button>
          
          <button type="button" 
                  class="action-btn status-btn"
                  [class]="user.status === 'ACTIVE' ? 'suspend-btn' : 'activate-btn'"
                  (click)="toggleUserStatus(user)"
                  [title]="user.status === 'ACTIVE' ? 'T·∫°m kh√≥a' : 'K√≠ch ho·∫°t'">
            {{ user.status === 'ACTIVE' ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è' }}
          </button>
          
          <button type="button" 
                  class="action-btn delete-btn"
                  (click)="confirmDeleteUser(user)"
                  title="X√≥a ng∆∞·ªùi d√πng">
            üóëÔ∏è
          </button>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-container">
      <div class="loading-spinner"></div>
      <p class="loading-text">ƒêang t·∫£i danh s√°ch ng∆∞·ªùi d√πng...</p>
    </div>

    <!-- Empty State -->
    <div *ngIf="!isLoading && users.length === 0" class="empty-state">
      <div class="empty-icon">üë•</div>
      <h3 class="empty-title">Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi d√πng</h3>
      <p class="empty-description">
        {{ searchQuery ? 'Kh√¥ng c√≥ k·∫øt qu·∫£ n√†o ph√π h·ª£p v·ªõi t√¨m ki·∫øm c·ªßa b·∫°n' : 'Ch∆∞a c√≥ ng∆∞·ªùi d√πng n√†o trong h·ªá th·ªëng' }}
      </p>
    </div>
  </div>

  <!-- Pagination -->
  <div class="pagination-container" *ngIf="totalPages > 1">
    <button type="button" 
            class="pagination-btn"
            [disabled]="currentPage === 1"
            (click)="goToPage(currentPage - 1)">
      ‚Üê Tr∆∞·ªõc
    </button>
    
    <div class="page-numbers">
      <button *ngFor="let page of getPageNumbers()" 
              type="button"
              class="page-btn"
              [class.active]="page === currentPage"
              [disabled]="page === '...'"
              (click)="page !== '...' && goToPage(+page)">
        {{ page }}
      </button>
    </div>
    
    <button type="button" 
            class="pagination-btn"
            [disabled]="currentPage === totalPages"
            (click)="goToPage(currentPage + 1)">
      Sau ‚Üí
    </button>
  </div>
</div>

<!-- User Details Modal -->
<div *ngIf="showDetailsModal" class="modal-overlay" (click)="showDetailsModal = false">
  <div class="modal-content large" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2 class="modal-title">Chi ti·∫øt ng∆∞·ªùi d√πng</h2>
      <button type="button" class="close-btn" (click)="showDetailsModal = false">‚úï</button>
    </div>
    
    <div *ngIf="selectedUser" class="user-details-content">
      <div class="detail-section">
        <div class="detail-row">
          <span class="detail-label">·∫¢nh ƒë·∫°i di·ªán:</span>
          <img [src]="selectedUser.avatarUrl || defaultAvatar" 
               [alt]="selectedUser.fullName" 
               class="detail-avatar">
        </div>
        
        <div class="detail-row">
          <span class="detail-label">H·ªç v√† t√™n:</span>
          <span class="detail-value">{{ selectedUser.fullName }}</span>
        </div>
        
        <div class="detail-row">
          <span class="detail-label">Email:</span>
          <span class="detail-value">{{ selectedUser.email }}</span>
        </div>
        
        <div class="detail-row">
          <span class="detail-label">Vai tr√≤:</span>
          <span class="role-badge" [class]="'role-' + selectedUser.role.toLowerCase()">
            {{ getRoleDisplay(selectedUser.role) }}
          </span>
        </div>
        
        <div class="detail-row">
          <span class="detail-label">Tr·∫°ng th√°i:</span>
          <span class="status-badge" [class]="'status-' + selectedUser.status.toLowerCase()">
            {{ getStatusDisplay(selectedUser.status) }}
          </span>
        </div>
        
        <div class="detail-row">
          <span class="detail-label">Gi·ªõi thi·ªáu:</span>
          <span class="detail-value">{{ selectedUser.bio || 'Ch∆∞a c√≥ gi·ªõi thi·ªáu' }}</span>
        </div>
        
        <div class="detail-row">
          <span class="detail-label">Ng√†y t·∫°o:</span>
          <span class="detail-value">{{ formatDate(selectedUser.createdAt) }}</span>
        </div>
        
        <div class="detail-row">
          <span class="detail-label">C·∫≠p nh·∫≠t cu·ªëi:</span>
          <span class="detail-value">{{ formatDate(selectedUser.updatedAt) }}</span>
        </div>
        
        <div class="detail-row">
          <span class="detail-label">ƒêƒÉng nh·∫≠p cu·ªëi:</span>
          <span class="detail-value">{{ formatDate(selectedUser.lastLoginAt) }}</span>
        </div>
      </div>
    </div>
    
    <div class="modal-actions">
      <button type="button" class="btn btn-secondary" (click)="showDetailsModal = false">
        ƒê√≥ng
      </button>
      <button type="button" class="btn btn-primary" (click)="editUser(selectedUser!)">
        Ch·ªânh s·ª≠a
      </button>
    </div>
  </div>
</div>

<!-- Create/Edit User Modal -->
<div *ngIf="showCreateModal || showEditModal" class="modal-overlay" (click)="closeEditModal()">
  <div class="modal-content large" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2 class="modal-title">
        {{ showCreateModal ? 'T·∫°o ng∆∞·ªùi d√πng m·ªõi' : 'Ch·ªânh s·ª≠a ng∆∞·ªùi d√πng' }}
      </h2>
      <button type="button" class="close-btn" (click)="closeEditModal()">‚úï</button>
    </div>
    
    <form [formGroup]="userForm" (ngSubmit)="onSubmitUser()" class="user-form">
      
      <!-- Full Name -->
      <div class="form-group">
        <label class="form-label">H·ªç v√† t√™n *</label>
        <input type="text" 
               formControlName="fullName"
               class="form-input"
               placeholder="Nh·∫≠p h·ªç v√† t√™n"
               [class.error]="isFieldInvalid('fullName')">
        <div *ngIf="isFieldInvalid('fullName')" class="error-message">
          <span *ngIf="userForm.get('fullName')?.errors?.['required']">Vui l√≤ng nh·∫≠p h·ªç v√† t√™n</span>
          <span *ngIf="userForm.get('fullName')?.errors?.['minlength']">H·ªç v√† t√™n ph·∫£i c√≥ √≠t nh·∫•t 2 k√Ω t·ª±</span>
        </div>
      </div>

      <!-- Email -->
      <div class="form-group">
        <label class="form-label">Email *</label>
        <input type="email" 
               formControlName="email"
               class="form-input"
               placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ email"
               [class.error]="isFieldInvalid('email')">
        <div *ngIf="isFieldInvalid('email')" class="error-message">
          <span *ngIf="userForm.get('email')?.errors?.['required']">Vui l√≤ng nh·∫≠p email</span>
          <span *ngIf="userForm.get('email')?.errors?.['email']">Email kh√¥ng h·ª£p l·ªá</span>
        </div>
      </div>

      <!-- Role -->
      <div class="form-group">
        <label class="form-label">Vai tr√≤ *</label>
        <select formControlName="role" class="form-input">
          <option value="USER">H·ªçc vi√™n</option>
          <option value="ADMIN">Qu·∫£n tr·ªã vi√™n</option>
          <option value="SUPER_ADMIN">Qu·∫£n tr·ªã c·∫•p cao</option>
        </select>
      </div>

      <!-- Status -->
      <div class="form-group">
        <label class="form-label">Tr·∫°ng th√°i *</label>
        <select formControlName="status" class="form-input">
          <option value="ACTIVE">Ho·∫°t ƒë·ªông</option>
          <option value="SUSPENDED">T·∫°m kh√≥a</option>
        </select>
      </div>

      <!-- Bio -->
      <div class="form-group">
        <label class="form-label">Gi·ªõi thi·ªáu</label>
        <textarea formControlName="bio"
                  class="form-textarea"
                  placeholder="Vi·∫øt v√†i d√≤ng gi·ªõi thi·ªáu..."
                  rows="3"></textarea>
      </div>
    </form>
    
    <div class="modal-actions">
      <button type="button" class="btn btn-secondary" (click)="closeEditModal()">
        H·ªßy b·ªè
      </button>
      <button type="button" 
              class="btn btn-primary" 
              [disabled]="userForm.invalid || isSaving"
              (click)="onSubmitUser()">
        <span *ngIf="isSaving" class="loading-spinner"></span>
        {{ isSaving ? 'ƒêang l∆∞u...' : (showCreateModal ? 'T·∫°o ng∆∞·ªùi d√πng' : 'L∆∞u thay ƒë·ªïi') }}
      </button>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div *ngIf="showDeleteModal" class="modal-overlay" (click)="showDeleteModal = false">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <h2 class="modal-title">‚ö†Ô∏è X√°c nh·∫≠n x√≥a ng∆∞·ªùi d√πng</h2>
    <p class="modal-text">
      B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ng∆∞·ªùi d√πng <strong>{{ userToDelete?.fullName }}</strong>?
      H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.
    </p>
    
    <div class="modal-actions">
      <button type="button" class="btn btn-secondary" (click)="showDeleteModal = false">
        H·ªßy b·ªè
      </button>
      <button type="button" class="btn btn-danger" (click)="deleteUser()">
        X√≥a ng∆∞·ªùi d√πng
      </button>
    </div>
  </div>
</div>